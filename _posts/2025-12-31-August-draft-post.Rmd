---
title: "August post"
author: "Sean Thompson"
---
Every quarter, the City of Seattle‚Äôs Office of Economic and Revenue Forecasts releases updated projections of city revenues to inform budget planning and policy decisions. As part of my job, last week, I had the opportunity to contribute to the development of the August revenue and economic forecasts, with my domain being the private utility tax revenues. Specifically, I created forecasts for Natural Gas, Steam, Waste, Cable and Telephone revenues for the next 6 years.

Doesn't sound particularly interesting, right? Well, in this blog post, I‚Äôll walk through the forecasting process, the tools I used (R and EViews), and share a few reflections on what it means to build forecasts that influence a city that I hold dear. 


## üèôÔ∏è What Are Private Utility Taxes?

As per [city law] (https://library.municode.com/wa/seattle/codes/municipal_code?nodeId=TIT5REFITA_SUBTITLE_IITA_CH5.48BUTTI), Seattle levies a tax on private utility companies' revenues. Some are affected by the weather, like Steam and Natural Gas, both used to heat homes and office buildings during cold months. Other utilities are more affected by consumer decisions, like Cable and Telephone. The weather effected revenues are based on various time-series econometric models like ARIMA, ARDL, VAR and VEC models. But before I get into the gnitty gritty, it's important to talk about the data. 

## An example
Lets take Natural Gas revenues, my largest revenue stream totaling ~$14 million. 

Using the package, dbplyr, I use SQL code to pull tax data, collecting info from a server older than me. 

Info like: 

- When tax obligations accrue
- Who pays, and when it's processed
- And that's pretty much it

After a query, I get a slick dataset suitable for Eviews, the workhorse for time-series forecasting. The data looks like this: 

```{r example_gas_dataset, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(flextable)
company_names <- c("Acme Corp", "Beta LLC", "Gamma Inc")
example_df <- data.frame(
  obl_id = sample(10000:99999, size = 10, replace = TRUE),
  pymnt_id = sample(10000:99999, size = 10, replace = TRUE),
  pymnt_date = sample(
    seq.Date(
      from = as.Date("2020-01-01"),
      to = as.Date("2025-08-31"),
      by = "day"
    ),
    size = 10,
    replace = TRUE
  ),
  pymnt_amt = sample(0:1500000, size = 10, replace = FALSE),
  batch_id = sample(1000:2500, size = 10, replace = TRUE),
  trade_name = sample(company_names, size = 10, replace = TRUE),
  naics_code = 221210,
  obl_type_description = "Nat Gas Utility"
)
example_df <- example_df %>%
  arrange(pymnt_date) %>%
  mutate(obl_period = as.numeric(format(pymnt_date, "%m")),
         obl_yr = year(pymnt_date)) %>%
  mutate(
    business_id = case_when(
      trade_name == "Acme Corp" ~ 3232,
      trade_name == "Beta LLC" ~ 777894,
      trade_name == "Gamma Inc" ~ 107990
    )
  ) %>%
  select(
    obl_id,
    pymnt_id,
    pymnt_date,
    pymnt_amt,
    batch_id,
    obl_period,
    obl_yr,
    obl_type_description,
    business_id,
    trade_name,
    naics_code
  )

example_df %>% 
  flextable() %>% 
     colformat_num(j = c(1, 2, 5,  7,9, 11), big.mark = "") %>% 
    theme_zebra() 

```

And since this is a forecast, the natural next step is to plot the data: 

```{r example_grph, echo = FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(here)
library(dplyr)
library(lubridate)
library(ggplot2)


theme_resid <- function(base_size = 14, base_family = "") {
  theme_minimal(base_size = base_size, base_family = base_family) +
    theme(
      # Transparent backgrounds so website color shows through
      plot.background   = element_rect(fill = "transparent", color = NA),
      panel.background  = element_rect(fill = "transparent", color = NA),
      legend.background = element_rect(fill = "transparent", color = NA),
      
      # Grid lines - mid-gray so visible on both light and dark
      panel.grid.major  = element_line(color = "#A0A0A0", size = 0.4),
      panel.grid.minor  = element_line(color = "#C0C0C0", size = 0.2),
      
      # Text - off-white so it works on both backgrounds
      text              = element_text(color = "#EAEAEA"),
      axis.text         = element_text(color = "#EAEAEA"),
      axis.title        = element_text(color = "#EAEAEA", face = "bold"),
      plot.title        = element_text(color = "#EAEAEA", face = "bold", size = rel(1.2)),
      plot.subtitle     = element_text(color = "#EAEAEA"),
      legend.text       = element_text(color = "#EAEAEA"),
      legend.title      = element_text(color = "#EAEAEA", face = "bold"),
      
      # Remove axis ticks for a cleaner look
      axis.ticks        = element_blank()
    )
}
set.seed(123)

# Generate monthly dates
dates <- seq.Date(from = as.Date("2010-01-01"),
                  to = as.Date("2025-12-01"),
                  by = "month")

n <- length(dates)

# Simulate monthly growth rates of market price (%)
market_price_growth <- rnorm(n, mean = 0.3, sd = 1)  # avg 0.3% monthly growth with some noise

# Convert growth rates from % to multiplier
growth_multipliers <- 1 + market_price_growth / 100

# Calculate cumulative growth index starting at 100
market_price_index <- cumprod(growth_multipliers) * 100

# Simulate natural gas usage starting at 500 units, roughly tracking price index + noise
natural_gas_usage <- market_price_index * (0.8 + rnorm(n, mean = 0, sd = 0.05))

# Create long-format dataframe
df <- data.frame(
  date = rep(dates, 2),
  variable = rep(c("market_price_index", "Natural Gas Tax Revenues"), each = n),
  value = c(market_price_index, natural_gas_usage)
)

# Round for neatness
df$value <- round(df$value, 2)


ggplot(df %>% 
         filter(variable == "Natural Gas Tax Revenues"), aes(x = date, y = value, color = variable)) +
  geom_line(size = 1) +
  labs(title = "Natural Gas Utility Tax Revenue (2010-2025)",
       x = "Date",
       y = "Index / Usage",
       color = "Variable") +
  theme_resid()

ggplot
```
## üîç My Role in the August Forecast

As part of the Forecast Office team, I was responsible for forecasting the City‚Äôs private utility tax revenues for the upcoming biennium and mid-term budget outlook. My workflow involved:

- **Data Cleaning and Exploration in R:** I used R to explore historical collections data, adjust for known anomalies, and visualize trends and seasonality in utility tax receipts.
- **Econometric Modeling in EViews:** I built time series models to project revenues using external drivers such as heating and cooling degree days, regional employment, and energy prices.
- **Scenario Analysis:** I helped test how different economic assumptions ‚Äî like a mild winter or shifts in natural gas usage ‚Äî could affect the revenue outlook.


## üìä Tools of the Trade: EViews + R

We use a hybrid toolchain:  
- **EViews** is great for fast implementation of ARIMA and regression models with diagnostics and forecasting built in. It‚Äôs especially helpful when working with time series data tied to economic indicators.  
- **R** complements EViews with powerful visualization (thanks to `ggplot2`), flexible data wrangling (`dplyr`, `tidyr`), and transparent documentation through R Markdown ‚Äî which is how I packaged and shared my analysis internally.

Here‚Äôs an example of a plot generated in R:

```r
ggplot(data = forecast_df, aes(x = date, y = revenue, color = scenario)) +
  geom_line(size = 1.2) +
  labs(title = "Forecasted Private Utility Tax Revenue",
       x = "Date", y = "Revenue ($, millions)",
       caption = "Source: Office of Economic and Revenue Forecasts") +
  theme_minimal()
  ```